<!DOCTYPE html>
<html>
   <head>
      <title>Plataforma de Consultas de dados censitários</title>
      <!--<script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.2/angular.js"></script>-->
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angular-ui-router/1.0.0-rc.1/angular-ui-router.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
      <script src="javascripts/censoApp.js" type="text/javascript"></script>

      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css">
      <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.3/css/select.bootstrap.min.css">
      
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
          
      <!-- Bootbox, para mensagens em Modal -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>

      <link rel='stylesheet' href='/stylesheets/style.css'/>
   </head>

   <script type="text/javascript">
      function disableGera () {
         document.getElementById("btnGeraArq").disabled = true;
         document.getElementById("arqGerado").style.display = "inline-block";
      }

      function initGera () {
         document.getElementById("btnGeraArq").disabled = true;
         document.getElementById("arqGerado").style.display = "none";
      }
      
      function EnableGera () {
         document.getElementById("btnGeraArq").disabled = false;
      }

      function changeCenso () {
        /*
         document.getElementById("colecao").selectedIndex = 0;
         document.getElementById("estado").selectedIndex = 0;
         */
        initGera ();
      }

      function changeCollection () {
        initGera ();
      }

      function changeTheme () {
        console.log ("onChangeTheme - index.html");
      }

      function changeUF () {
        initGera ();
      }

      function varSelect () {
        console.log ("VarSelect");
      }

      function myfunc(div) {
        /*
        var className = div.getAttribute("class");
        var classDisable = div.getAttribute("class");
        console.log ("MyFunc",div,className)
        console.log ("CLASSNAME",className)
        if(className == "option-selected") {
          div.className = "";
        }
        else{
          div.className = "option-selected";
        }
        */
      }
      
   </script>

   <!-- ******************************** -->
   <!-- ng-controller = submitController -->
   <!-- ******************************** -->
   
   <body ng-app="censoApp" ng-controller="submitController">
     <!--
      <div class="page-header">
         <h2>Plataforma de Consultas de dados censitários</h2>
         <small>Bem-vindo à Plataforma</small>
      </div>
    -->

    <header>
      <div id="logo" style="background:url(images/cem.jpg) 0 20px no-repeat; float:left;margin-left:20px">
          <a href="http://www.fflch.usp.br/centrodametropole/" style="width:455px; height:100px;display:block;"></a>
      </div>
      &nbsp&nbsp&nbsp
      <h1 class = "fixed-width" style = "margin-left:100px;color:gray">&nbsp&nbsp&nbspPlataforma de extração <br> &nbsp&nbsp&nbspde dados censitários</h1>
    </header>

    <br><br><br>

    
    <div class="container" style="width:1000px">

      <div class="panel panel-primary" style="margin-bottom:10px">
          <div class="panel-heading">Seleção de variáveis</div>

          <div class="row" style="margin-left:1px">

            <div class="form-inline" style="padding:10px">
                <!-- ******************************** -->
                <!-- ng-controller = tablesController -->
                <!-- ******************************** -->
                <div class="form-group" ng-controller="tablesController" style="vertical-align:top"> 
                  <!--<input type="text" ng-model="parameters.title">-->                  
                  <label> Tipo de dados:</label>
                  <br>
                  <select id="colecao" name="colecao" class="form-control input-sm" onchange="changeCollection()" ng-model="parameters.tabela" ng-change="updateVars()">
                      <option value="">Selecione um tipo</option>
                      <option value="tDom">Domicílio</option>
                      <option value="tPes">Pessoa</option>
                      <!--
                      <option value="{{item.value}}" ng-repeat="item in data.colecoes">{{item.label}}</option>
                      -->
                  </select>
                </div>
              
                <!-- ******************************** -->
                <!-- ng-controller = themController  -->
                <!-- ******************************** -->
                <div class="form-group" ng-controller="themeController" style="vertical-align:top;margin-left:10px;"> 
                  <label>Temas:</label>
                  <br>
                  <select id="theme" name="theme" class="form-control input-sm" onchange="changeTheme()" ng-model="parameters.theme" ng-change="changeTheme()" style = "width:120px">
                      <!-- <option value="">Selecione um ano</option> -->
                      <option value="">Selecione um tema</option>
                      <option value="{{item}}" ng-repeat="item in data.themes">{{item.label}}</option>
                  </select>
                </div>

                <!-- ******************************** -->
                <!-- ng-controller = yearsController  -->
                <!-- ******************************** -->
                <div class="form-group" ng-controller="yearsController" style="margin-left:10px;"> 
                  <label>Censos:</label>
                  <br>
                  <select multiple size="4" id="ano" name="ano" class="form-control input-sm" onchange="changeCenso()" ng-model="parameters.ano" ng-change="changeCenso()" style = "min-width:120px">
                      <!-- <option value="">Selecione um ano</option> -->
                      <option value="{{item.year}}" ng-repeat="item in data.years">{{item.year}}</option>
                  </select>
                </div>

                <!-- ******************************** -->
                <!-- ng-controller = ufsController    -->
                <!-- ******************************** -->
                <div class="form-group" ng-controller="ufsController" style="display:none">
                  <label for="estado">Estado:</label>
                  <br>
                  <select multiple  size="4" id="estado" name="estado" class="form-control input-sm" style = "min-width:120px" onchange="changeUF()" ng-model="parameters.estado" ng-change="changeUF()">
                      <!-- <option value="">Todos</option> -->
                      <option value="{{item}}" ng-repeat="item in data.ufs">{{item.State}}</option>
                  </select>
                </div>

            </div> <!-- class="form-inline" -->
          </div> <!-- row -->

          <div class="row" style="margin-left:-1px">

            <div class="col-lg-4 col-md-4 col-sm-4">
               <!-- *********************************** -->
               <!-- ng-controller = variaveisController -->
               <!-- *********************************** -->
               <div class="form-group" ng-controller="variaveisController">
                  <br>
                  <label for="variavel" style="margin-bottom:15px">Variáveis de tema{{temaEscolhido}}:</label>
                  <br>
                  <select multiple id="variavel" name="variaveis[]" class="form-control input-sm" size="12" ng-model="parameters.variaveis" style="padding:0px">
                    <!-- <option value="">[Teste] teste <br> <strong>de</strong> texto</option> -->
                     <option class="{{item.collection.variable.disabled}}" value="{{item}}" ng-repeat="item in data.variaveis" ng-disabled="item.collection.variable.disabled=='option-selected'" onclick="myfunc(this)">[{{item.collection.variable.year}}-{{item.collection.variable.varCode}}] {{item.collection.variable.label}}</option>
                  </select>
                </div>
                <br>
              </div>

              <div class="col-sm-1" style="padding:10px;">
                <div class="form-group">
                  <br><br>
                  <label></label>
                  <br><br>
                  <button type="button" class="btn btn-primary btn-sm" data-toggle="tooltip" title="Selecionar variáveis de tema" onclick="varSelect()" ng-click="submitSelect()" style="height:40px">
                    <b>&nbsp;>&nbsp;</b>
                  </button>
                  <!--
                  <br><br>
                  <button type="button" class="btn btn-info btn-sm" onclick="varUnselect()">
                    &nbsp;<&nbsp;
                  </button>
                  <br>
                  -->
                  <!--
                  <button type="button" class="btn btn-success btn-sm" onclick="varTeste1()">
                    >>
                  </button>
                  <br><br>
                  <button type="button" class="btn btn-basic btn-sm" onclick="varTeste()">
                    <<
                  </button>
                -->
                  <br>
                </div>
              </div> <!-- class="col-md-1" -->

              <div class="col-lg-7 col-md-7 col-sm-7" style="padding:0px;">
                  <br>
                  <strong>Variáveis selecionadas</strong>
                  <br><br>
                <!--
                  <select multiple id="variavel" name="variaveis[]" class="form-control" size="11" ng-model="parameters.variaveis" style="padding:0px">
                    <option value="">[Teste] teste <br> <strong>de</strong> texto</option>
                     <option value="{{item}}" ng-repeat="item in data.variaveis">[{{item.year}}] [{{item.varCode}}] {{item.label}}</option>
                  </select>
                -->
                  <div style="height:185px;width:550px;overflow-y:scroll">
                    <table id = "tabSelectedVariables" name="selectedVariables[]"  class="table table-striped table-condensed" size="10px" style="height:0px;width:530px;font-size: 11px" ng-model="parameters.selectedVariables">
                      <tr>
      <!--                  <th><input type="checkbox" id="selectBox"></th> -->
                        <th style="vertical-align:middle;width:10px">Ano</th>
                        <th>Código</th>
                        <th>Descrição</th>
                        <th>Excluir</th>
                        <!-- <th></th> -->
                      </tr>
                      <tr ng-repeat="item in parameters.selectedVariables">
                        <td style="vertical-align:middle;">{{item.year}}</td>
                        <td style="vertical-align:middle;width:30px;padding-right:10px">{{item.varCode}}&nbsp&nbsp&nbsp&nbsp<a href="" data-toggle="modal" data-target="#myModal"><span data-toggle="tooltip" title="Clique para detalhes da variável {{item.varCode}}" class="glyphicon glyphicon-question-sign" ng-click="InfoVar(item)"></span></a></td> <!-- InfoVar(item) -->
                        <!--
                        <td style="vertical-align: middle;"><a href="#"><span class="glyphicon glyphicon-question-sign"></span></a></td>
                        -->
                        <td style="vertical-align:middle;">{{item.label}}</td>
                        <td style="vertical-align:middle;width:30px;text-align:center" ng-click="RemoveVar(item,$index)"><a href=""><span data-toggle="tooltip" title="Clique para excluir a variável {{item.varCode}} da lista de variáveis selecionadas" class="glyphicon glyphicon-remove" style="color:red"></span></a></td>
                        <!--
                        <td style="text-align:center;vertical-align:middle;"><input type="checkbox" id="V0001"></td>
                        <td>>= d</td>
                        <td><a data-toggle="modal" data-target="#GSCCModal">Editar 1 2 3 </a></td>
                        -->
                      </tr>
                    </table>
                  </div>
              </div>
          </div>
          
          
          
      </div>
  </div>
  




    <div id="containerfluid-01" class="container-fluid" style="width:1000px">


        <div class="row content"> <!-- row 3 -->
            <div class="col-sm-12">
              <div class="panel panel-primary" style = "height:135px">
                <div class="panel-heading">Extração</div>
                <br>
                <div class="form-inline" style="display:inline-block;height:212px;overflow:auto">
<!--                    <div id = "Censos_Temas" class="form-inline" style="width:400px">
-->                    
                    <div class="form-group panel panel-info" style = "margin-left:10px;width:465px;">
                        <div class="panel-heading">Opções de arquivo de saida</div>
                        <div class="panel-body" style="padding:5px">
                          <!--
                            <input type="radio" name="selectedSamples[]" id="sample_br2010a" value="br2010a">&nbspCSV delimitado por vírgula&nbsp&nbsp&nbsp&nbsp</input>
                            &nbsp
                            <input type="radio" name="selectedSamples[]" id="sample_br2010a" value="br2010a">&nbspCSV delimitado por ponto e vírgula</input>
                          -->
                          <input id = "radioCSVComma" type="radio" name="formatoDados" ng-model="parameters.formatoDados" value="csv-commas" checked="checked">&nbspCSV delimitado por vírgula&nbsp&nbsp&nbsp&nbsp</input>
                          &nbsp
                          <input id = "radioSemicolon" type="radio" name="formatoDados" ng-model="parameters.formatoDados" value="csv-semicolon">&nbspCSV delimitado por ponto e vírgula</input>
                      </div>
                    </div>
                    <div class="pull-right">
                      <!--
                      <input id="teste" class="form-group btn btn-info" style="margin-left:200px;width:120px" type="submit" value="teste rem" ng-click="submitTESTErem()">
                      -->
                      <input id="btnConfSolic" class="form-group btn btn-info" style="margin-left:200px;width:120px" type="submit" value="Visualizar" ng-click="submitQuery()" onclick="EnableGera()">

                      <input id="btnGeraArq" class="form-group btn btn-primary" style="margin-left:10px;width:120px" type="submit" value="Gerar arquivo" ng-click="submitGeraArquivo()" disabled=""  onclick="disableGera()">
                      <!--
                      <input id="btnGeraArq2" class="form-group btn btn-primary" style="margin-left:10px;width:120px" type="submit" value="Gerar arq." ng-click="submitGeraArquivo2()">
                      -->
                      
                      <p id="msgConfGera" class="help-block" style="margin-left:200px">{{msgConfirmaGera}}</p>
                      <div id="arqGerado" style="margin-left:200px;display: none">{{baixarArq}}
                        <a href="{{fileLink}}" download> {{texto}}
                        </a>
                      </div>
                        
                    </div>

                </div>
              </div> <!-- class="panel panel-primary" -->
            </div> <!-- class="col-sm-12" -->
        </div> <!-- class="row content" 3  -->


        <div class="row content"> <!-- row 4 -->
          <div class="col-sm-12">
              <fieldset>
                  <legend>Modelo de dados do arquivo</legend>
                  <!-- Add a controller to application -->
                  <div class="table-responsive">
                    <!--
                    <table class="table table-bordered table-hover table-striped" style="width:100%; font-size: 13">
                    -->
                    <table class="table table-bordered table-striped" style="width:100%; font-size: 13">
                      <thead>
                        <tr>
                          <th ng-repeat="(key, val) in dataQuery[0]">{{key}}</th>
                        </tr>
                      </thead>
                      <head>
                        <tr ng-repeat="item in dataQuery">
                          <td ng-repeat="(key, val) in item">{{val}}</td>
                        </tr>
                      </head>
                    </table>
                  </div> <!-- class="table-responsive" -->
                </fieldset>
          </div> <!-- class="col-sm-12" -->
        </div> <!-- class="row content" 4  -->
      

    </div> <!-- id="containerfluid-01" -->


<!-- Button trigger modal -->

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>

                </button>
                 <h4 class="modal-title" id="myModalLabel">Detalhes da variável {{codigoVariavel}} do Censo {{anoVariavel}}</h4>

            </div>
            <div class="modal-body">
                <div role="tabpanel">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#descTab" aria-controls="descTab" role="tab" data-toggle="tab">Descrição Detalhada</a></li>
                        <li role="presentation"><a href="#popToAplyTab" aria-controls="popToAplyTab" role="tab" data-toggle="tab">População a qual se aplica</a></li>
                        <li role="presentation"><a href="#obsTab" aria-controls="obsTab" role="tab" data-toggle="tab">Observações</a></li>
                        <li role="presentation"><a href="#catTab" aria-controls="catTab" role="tab" data-toggle="tab">Categorias</a></li>
                    </ul>
                    <!-- Tab panels -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="descTab" style="margin-left:10px;height:200px;overflow-y:scroll">
                          <br>
                          <p style="white-space:pre-wrap;">{{textoDescricaoVar}}</p>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="popToAplyTab" style="margin-left:10px;height:200px;overflow-y:scroll">
                          <br>
                          <p style="white-space:pre-wrap;">{{textoPopToApplyVar}}</p>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="obsTab" style="margin-left:10px;height:200px;overflow-y:scroll">
                          <br>
                          <p style="white-space:pre-wrap;">{{textoObsVar}}</p>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="catTab" style="margin-left:10px;height:200px;overflow-y:scroll">
                          <br>
                          <p style="white-space:pre-wrap;">{{textoCategoriaVar}}</p>
                          <table id = "tabCategory" name="category[]"  class="table table-condensed {{categoryTableClass}}" ng-model="data.category">
                            <tr>
                              <th style="vertical-align:middle;width:10px">Valor</th>
                              <th>Descrição</th>
                            </tr>
                            <tr ng-repeat="item in data.category">
                              <td ng-repeat="(key,val) in item" style="vertical-align:middle;">{{val}}</td>
                              <!-- <td style="vertical-align:middle;">{{item.label}}</td> -->
                            </tr>
                          </table>
                        </div>
                      </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

      
      <!-- MODAL... -->
      <!--
      <div id="GSCCModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"  ng-controller="variaveisController">
      <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;  </button>
              <h4 class="modal-title" id="myModalLabel">Filtro de variáveis</h4>
            </div>
            <div class="modal-body">
              Variáveis {{parameters.tabela}}<br>
                        <label for="{{item.varCode}}">Selecione as variáveis que deseja incluir na consulta:</label>
                        <br>
                        <select multiple id="{{item.varCode}}" name="variaveis[]" class="form-control" size="13" ng-model="parameters.variaveis">
                          <option value="{{item.varCode}}" ng-repeat="item in data.variaveis">[{{item.varCode}}] {{item.label}}</option>                 
                        </select>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-primary">Confirmar</button>
            </div>
          </div>
        </div>
      </div>
    -->
      <!-- ...MODAL -->

   </body>
   
</html>
